"0","for (i in unique(joined_data$Stadur)[1]) {"
"0","  "
"0","filtered_data <- joined_data  |> "
"0","    filter(Stadur %in% i & !Type %in% c(""Grænþörungar"", ""Cyanobacteria"")) |>"
"0","    select(where(~ !all(is.na(.))))"
"0",""
"0","# Pivot longer only with existing year columns"
"0","jd_long <- filtered_data |>"
"0","    pivot_longer(cols = starts_with(""19"") | starts_with(""20""), names_to = ""Year"", values_to = ""Coverage"")"
"0",""
"0","jd_long_Engin_NA <- jd_long[!is.na(jd_long$Coverage),]"
"0",""
"0","# Heildarfjöldi tegunda á ári í hverjum reit. Passa að hafa ekki plyr pakkann í gangi."
"0","# Fjöldi tegunda í reit á ári"
"0","species_counts <- jd_long_Engin_NA |>"
"0","  group_by(Reitur, Year) |> "
"0","  summarise(SpeciesCount = n_distinct(species), .groups = 'drop') |>"
"0","  # Meðalfjöldi tegunda í reit á ári"
"0","  group_by(Year) |>"
"0","  summarise(Mean = mean(SpeciesCount), SE = sd(SpeciesCount)) |> "
"0","  mutate(Type = ""Tegundafjöldi"")|> "
"0","  select(Type, Year, Mean, SE)"
"0",""
"0","# Meðalþekja reita eftir Type"
"0","df <- jd_long |> "
"0","  group_by(Type,Year,Reitur) |> "
"0","  summarise( Summa = sum(Coverage, na.rm = TRUE), .groups = 'drop') |> "
"0","  group_by(Type,Year) |> "
"0","  summarise(Mean=mean(Summa, na.rm=TRUE),SE = sd(Summa, na.rm=TRUE), .groups = 'drop')"
"0",""
"0","# heildarþekja (öll Type) allra reita innan ára"
"0","df_summary <- jd_long |> "
"0","  group_by(Year,Reitur) |> "
"0","  summarise( Summa = sum(Coverage, na.rm = TRUE), .groups = 'drop') |>"
"0","  group_by(Year) |> "
"0","  summarise(Mean=mean(Summa, na.rm=TRUE),SE = sd(Summa, na.rm = TRUE) / sqrt(length(Summa)), .groups = 'drop') |>"
"0","  mutate(Type = ""Heildarþekja"") |> "
"0","  select(Type, Year, Mean, SE)"
"0",""
"0",""
"0","df_with_heildarþekja <- bind_rows(df, df_summary, species_counts)"
"0","# Ensure Type is ordered as desired"
"0","df_with_heildarþekja$Type <- factor(df_with_heildarþekja$Type, levels = c(""Mosar"",""Blað- og runnfléttur"", ""Hrúðurfléttur"",""Heildarþekja"",  ""Tegundafjöldi""))"
"0",""
"0","# Plot"
"0","p1 <- ggplot(df_with_heildarþekja, aes(x = Type, y = Mean, fill = Year)) +"
"0","  geom_bar(stat = ""identity"",color = ""black"",size = .6,position = position_dodge(width = 0.75)) +"
"0","   # geom_errorbar(aes(ymin = Mean - SE, ymax = Mean + SE),width = .2,position = position_dodge(width = 0.75)) +"
"0","  scale_fill_manual(values = colors_dark2) +  # Use the Dark2 palette"
"0","  scale_y_continuous(labels = label_dollar(prefix = """", suffix = "" \n%""),"
"0","    # Example secondary axis (e.g., double the Mean for illustration)"
"0","    sec.axis = sec_axis( ~ . , name = ""Meðaltegundafjöldi"")) +"
"0","  labs(title = """", y = ""Meðalþekja"", x = """") +"
"0","  scale_x_discrete("""",labels = c("
"0","      ""Mosar"" = ""Mosar"","
"0","      ""Blað- og runnfléttur"" = ""Blað- og\nrunnfléttur"","
"0","      ""Hrúðurfléttur"" = ""Hrúðurfléttur"","
"0","      ""Heildarþekja"" = ""Heildarþekja"","
"0","      ""Tegundafjöldi"" = ""Tegundafjöldi"""
"0","    )) +"
"0","  theme_minimal() +"
"0","  theme(legend.title = element_blank(),"
"0","        plot.background = element_rect(fill = ""white"", color = NA)) +"
"0","  # annotate(""text"", x = 2,y = Inf,label = ""   Álfholt"",hjust = 1,vjust = 1,size = 8, angle = 0) "
"0","  ggtitle(i)+ "
"0","  theme(axis.title = element_text(size = 16),"
"0","        axis.text = element_text(size = 16),"
"0","        legend.text = element_text(size = 16),"
"0","        plot.title = element_text(size = 20))"
"0",""
"0","Filename <-  glue(""./myndir/"",i,""-"",""{paste(unique(filtered_data$Reitur), collapse='_')}.png"")"
"0","ggsave(filename = Filename, plot = p1, width = 11.7, height = 8.3, dpi = 300, units = ""in"")"
"0",""
"0",""
"0","}"
"0",""
